import { useEffect, useRef, useState } from "react";
import gsap from "gsap";
import "./IntroLoader.css";

const IntroLoader = ({ onComplete }) => {

    const loaderRef = useRef(null);
    const drawPathRef = useRef(null);
    const whiteRef = useRef(null);
    const purpleRef = useRef(null);
    const [progress, setProgress] = useState(0);

    useEffect(() => {
        const path = drawPathRef.current;
        const length = path.getTotalLength();

        gsap.set(path, {
            strokeDasharray: length,
            strokeDashoffset: length,
        });

        gsap.to(path, {
            strokeDashoffset: 5,
            duration: 12,
            ease: "power2.inOut",
            repeat: -1,
            yoyo: true,
        });

        // fake loading timer
        // ==================
        let p = 0;
        const interval = setInterval(() => {
            p += Math.random() * 8;
            if (p >= 100) {
                p = 100;
                clearInterval(interval);
                finish();
            }
            setProgress(Math.floor(p));
        }, 120);

        // Eindanimatie
        // ============
        const finish = () => {
            gsap.killTweensOf(drawPathRef.current);
            const tl = gsap.timeline({ onComplete: onComplete });

            tl
            .to(whiteRef.current, {
                x: "0%",
                duration: 0.8,
                ease: "power3.inOut",
            })
            .to(purpleRef.current, {
                x: "0%",
                duration: 0.8,
                ease: "power3.inOut",
            }, "-=0.6")
            .to(loaderRef.current, {
                x: "110%",
                opacity: 0,
                pointerEvents: "none",
                duration: 1.2,
                ease: "power3.inOut",
                stagger: 0.05,
            }, "-=0.85") 
            .to([purpleRef.current, whiteRef.current], {
                x: "110%",
                duration: 1.2,
                ease: "power3.inOut",
                stagger: 0.1,
            }, "-=0.2");
        };

        return () => clearInterval(interval);
    }, []);

    return (
        <>
            {/* TRANSITION PANELS */}
            <div className="transition">
                <div ref={whiteRef} className="panel white" />
                <div ref={purpleRef} className="panel purple" />
            </div>

            {/* LOADER */}
            <div ref={loaderRef} className="intro-loader">
                <svg className="be-svg" viewBox="0 0 1200 500" aria-hidden>
                    {/* STATIC OUTLINE */}
                    <path
                        d="M267.67,683.29c-6.05-4.67-14.43-7.55-25.1-8.68h-.02c-3.6-.09-7.26-.14-10.98-.14h-87.63v72.03h87.63c16.08.03,28.11-3.04,36.1-9.21,3.27-2.5,5.88-5.48,7.82-8.92.3-.53.58-1.07.85-1.62.26-.55.52-1.12.75-1.69.12-.29.23-.58.34-.87.22-.59.43-1.18.61-1.79.38-1.21.69-2.47.94-3.78.12-.65.23-1.32.33-1.99.28-2.03.42-4.15.42-6.38,0-11.81-3.99-20.79-12.06-26.96ZM406.53,939.59c-13.34-19.12-32.25-33.72-56.73-43.79-1.02-.45-2.07-.83-3.14-1.15,17.56-9.82,31.33-22.24,41.39-37.39,11.99-17.99,18.06-38.47,18.19-61.44-6.96,9.6-15.71,18.2-26.25,25.78-31.07,22.39-76.43,33.58-136.08,33.58H.8v280.37h243.11c59.65,0,105.01-11.2,136.08-33.59,31.11-22.39,46.64-53.56,46.59-93.52,0-26.81-6.68-49.76-20.05-68.85ZM267.67,1017.65c-7.99,6.17-20.02,9.24-36.1,9.22h-87.63v-72.43h87.63c16.05,0,28.11,3.05,36.1,9.21,8.07,6.17,12.06,15.16,12.06,26.97s-3.99,20.86-12.06,27.03ZM807.05,852.31c-6.34-10.27-13.44-19.6-21.32-27.99-11.89,9.34-25.07,16.97-39.19,22.63-24.04,9.9-52.94,14.86-86.7,14.86-41.1-.03-76.99-8.15-107.67-24.38-12.73-6.75-24.27-14.55-34.63-23.41-14.6,12.55-27.1,27.48-36.94,44.23-16.7,28.1-25.02,60.36-24.98,96.8,0,35.56,8.42,67.52,25.26,95.88,16.92,28.34,40.68,50.62,71.29,66.87,30.68,16.22,66.57,24.35,107.67,24.37,33.76,0,62.66-4.95,86.7-14.85,23.38-9.38,44.21-24.15,60.8-43.11l-72.78-78.44c-11.14,8.83-21.7,15.38-31.83,19.8-10.06,4.42-22.9,6.55-38.53,6.55s-28.19-2.74-38.89-8.23c-10.62-5.41-19.26-14.05-24.69-24.67-1.56-2.97-2.9-6.05-4-9.22h234.19c.36-5.25.78-11.12,1.21-17.44.43-6.4.65-12.19.65-17.52,0-40.82-8.54-75.06-25.62-102.73ZM593.62,918.19c1.03-5.78,2.75-11.4,5.14-16.76,4.1-9.41,10.84-17.43,19.41-23.08,8.49-5.48,18.41-8.22,29.97-8.22s21.41,2.74,29.61,8.22c8.21,5.49,14.7,13.18,19.41,23.08,2.55,5.32,4.37,10.95,5.42,16.76h-108.96ZM932.09,1140.12c-15.99,0-29.4-5.56-40.25-16.68-10.84-11.12-16.26-25.36-16.27-42.73,0-17.67,5.42-31.83,16.27-42.49,10.84-10.66,24.26-15.99,40.25-15.99s29.4,5.33,40.24,15.99,16.27,24.83,16.27,42.49c0,17.37-5.42,31.61-16.27,42.73s-24.26,16.68-40.24,16.68ZM406.53,265.98c-13.34-19.12-32.25-33.71-56.73-43.79-1.02-.45-2.07-.83-3.14-1.14,17.56-9.83,31.33-22.24,41.39-37.4,12.13-18.2,18.2-38.94,18.2-62.22,0-35.11-14.2-63.98-42.6-86.6C335.25,12.2,291.22.88,231.57.86H.8v393.25h230.77c59.65.02,103.68,11.34,132.08,33.96,2.55,2.03,4.98,4.11,7.3,6.25,3.14-1.89,6.15-3.88,9.04-5.96,31.11-22.39,46.64-53.57,46.59-93.53,0-26.81-6.68-49.76-20.05-68.85ZM143.94,109.55h67.93c16.42,0,28.45,2.87,36.11,8.6,7.56,5.72,11.42,14.25,11.42,25.67s-3.86,19.42-11.42,25.36c-7.64,5.94-19.67,8.91-36.11,8.91h-67.93v-68.54ZM267.67,344.05c-7.99,6.17-20.02,9.24-36.1,9.21h-87.63v-72.43h87.63c16.05,0,28.11,3.05,36.1,9.22,8.07,6.17,12.06,15.15,12.06,26.96s-3.99,20.87-12.06,27.04ZM807.05,178.69c-17.05-27.65-39.67-48.49-67.86-62.53-28.19-14.09-58.94-21.12-92.26-21.1-36.25,0-68.86,7.9-97.83,23.69-28.45,15.26-52.15,38.05-68.5,65.88-16.7,28.1-25.02,60.37-24.97,96.8,0,35.57,8.42,67.53,25.26,95.89,16.91,28.33,40.67,50.62,71.28,66.87,30.68,16.22,66.57,24.35,107.67,24.37,33.75,0,62.65-4.95,86.7-14.85,23.37-9.39,44.2-24.15,60.79-43.11l-72.78-78.45c-11.13,8.83-21.69,15.39-31.82,19.8-10.06,4.42-22.91,6.55-38.53,6.55s-28.18-2.74-38.89-8.23c-10.63-5.42-19.27-14.05-24.7-24.67-1.57-2.97-2.9-6.05-4-9.22h234.19c.36-5.25.78-11.12,1.21-17.44.43-6.4.64-12.19.64-17.52,0-40.82-8.54-75.07-25.62-102.74ZM593.62,244.57c1.02-5.77,2.75-11.4,5.14-16.76,4.09-9.41,10.84-17.43,19.41-23.08,8.49-5.48,18.41-8.23,29.97-8.23s21.41,2.74,29.61,8.23,14.7,13.18,19.41,23.08c2.55,5.32,4.37,10.95,5.42,16.76h-108.96ZM932.09,466.51c-15.99,0-29.4-5.56-40.25-16.68-10.84-11.12-16.26-25.36-16.27-42.73,0-17.67,5.42-31.83,16.27-42.49,10.84-10.66,24.26-15.99,40.25-15.99s29.4,5.33,40.24,15.99,16.27,24.83,16.27,42.49c0,17.37-5.42,31.61-16.27,42.73-10.85,11.12-24.26,16.68-40.24,16.68ZM276.34,726.75c-.27.55-.56,1.09-.85,1.62M406.53,659.22c-13.34-19.12-32.25-33.71-56.73-43.79-1.02-.45-2.07-.83-3.14-1.14,17.56-9.83,31.33-22.24,41.39-37.4,12.13-18.2,18.2-38.94,18.2-62.22,0-31.96-11.77-58.75-35.3-80.35-2.32-2.14-4.75-4.22-7.3-6.25-28.4-22.62-72.43-33.94-132.08-33.96H.8v461.07h243.11c59.65,0,105.01-11.19,136.08-33.58,10.54-7.58,19.29-16.18,26.25-25.78,13.59-18.74,20.37-41.33,20.34-67.75,0-26.81-6.68-49.76-20.05-68.85ZM143.94,502.79h67.93c16.42,0,28.47,2.89,36.11,8.6,7.56,5.71,11.42,14.24,11.42,25.67s-3.86,19.42-11.42,25.36c-7.64,5.94-19.67,8.91-36.11,8.91h-67.93v-68.54ZM279.31,716.63c-.1.67-.21,1.34-.33,1.99-.25,1.31-.56,2.57-.94,3.78-.18.61-.39,1.2-.61,1.79-.11.29-.22.58-.34.87-.23.57-.49,1.14-.75,1.69-.27.55-.55,1.09-.85,1.62-1.94,3.44-4.55,6.42-7.82,8.92-7.99,6.17-20.02,9.24-36.1,9.21h-87.63v-72.43h87.63c3.9,0,7.56.18,10.98.54h.02c10.67,1.13,19.05,4.01,25.1,8.68,8.07,6.17,12.06,15.15,12.06,26.96,0,2.23-.14,4.35-.42,6.38ZM807.05,571.94c-17.06-27.65-39.68-48.49-67.86-62.53-28.19-14.09-58.94-21.12-92.26-21.1-36.25,0-68.86,7.9-97.83,23.69-28.45,15.26-52.15,38.05-68.5,65.88-16.7,28.1-25.02,60.37-24.98,96.8,0,35.57,8.42,67.53,25.26,95.89,9.88,16.55,22.1,31.04,36.66,43.45,10.36,8.86,21.9,16.66,34.63,23.41,30.68,16.23,66.57,24.35,107.67,24.38,33.76,0,62.66-4.96,86.7-14.86,14.12-5.66,27.3-13.29,39.19-22.63,7.8-6.11,15.03-12.96,21.61-20.47l-72.78-78.45c-11.14,8.84-21.7,15.39-31.83,19.8-10.06,4.42-22.9,6.55-38.53,6.55s-28.19-2.74-38.89-8.22c-10.63-5.42-19.27-14.05-24.69-24.67-1.57-2.97-2.91-6.05-4-9.22h234.19c.36-5.26.78-11.12,1.21-17.44.43-6.4.65-12.19.65-17.52,0-40.82-8.54-75.07-25.62-102.74ZM593.62,637.82c1.03-5.77,2.75-11.4,5.14-16.75,4.1-9.42,10.84-17.44,19.41-23.08,8.49-5.49,18.41-8.23,29.97-8.23s21.41,2.74,29.61,8.23c1.54,1.03,3.02,2.13,4.44,3.32.94.78,1.86,1.61,2.75,2.47,4.9,4.71,8.98,10.48,12.22,17.29,2.55,5.31,4.37,10.95,5.42,16.75h-108.96ZM932.09,859.76c-15.99,0-29.4-5.56-40.25-16.68-10.84-11.12-16.26-25.36-16.27-42.73,0-17.67,5.42-31.83,16.27-42.49,10.84-10.66,24.26-15.99,40.25-15.99s29.4,5.33,40.24,15.99c10.85,10.66,16.27,24.83,16.27,42.49,0,17.37-5.42,31.61-16.27,42.73s-24.26,16.68-40.24,16.68M932.09,859.76c-15.99,0-29.4-5.56-40.25-16.68-10.84-11.12-16.26-25.36-16.27-42.73,0-17.67,5.42-31.83,16.27-42.49,10.84-10.66,24.26-15.99,40.25-15.99s29.4,5.33,40.24,15.99c10.85,10.66,16.27,24.83,16.27,42.49,0,17.37-5.42,31.61-16.27,42.73s-24.26,16.68-40.24,16.68Z"
                        fill="none"
                        stroke="rgba(255,255,255,0.40)"
                        strokeWidth="1"
                    />

                    {/* DRAWING PATH */}
                    <path
                        ref={drawPathRef}
                        d="M267.67,683.29c-6.05-4.67-14.43-7.55-25.1-8.68h-.02c-3.6-.09-7.26-.14-10.98-.14h-87.63v72.03h87.63c16.08.03,28.11-3.04,36.1-9.21,3.27-2.5,5.88-5.48,7.82-8.92.3-.53.58-1.07.85-1.62.26-.55.52-1.12.75-1.69.12-.29.23-.58.34-.87.22-.59.43-1.18.61-1.79.38-1.21.69-2.47.94-3.78.12-.65.23-1.32.33-1.99.28-2.03.42-4.15.42-6.38,0-11.81-3.99-20.79-12.06-26.96ZM406.53,939.59c-13.34-19.12-32.25-33.72-56.73-43.79-1.02-.45-2.07-.83-3.14-1.15,17.56-9.82,31.33-22.24,41.39-37.39,11.99-17.99,18.06-38.47,18.19-61.44-6.96,9.6-15.71,18.2-26.25,25.78-31.07,22.39-76.43,33.58-136.08,33.58H.8v280.37h243.11c59.65,0,105.01-11.2,136.08-33.59,31.11-22.39,46.64-53.56,46.59-93.52,0-26.81-6.68-49.76-20.05-68.85ZM267.67,1017.65c-7.99,6.17-20.02,9.24-36.1,9.22h-87.63v-72.43h87.63c16.05,0,28.11,3.05,36.1,9.21,8.07,6.17,12.06,15.16,12.06,26.97s-3.99,20.86-12.06,27.03ZM807.05,852.31c-6.34-10.27-13.44-19.6-21.32-27.99-11.89,9.34-25.07,16.97-39.19,22.63-24.04,9.9-52.94,14.86-86.7,14.86-41.1-.03-76.99-8.15-107.67-24.38-12.73-6.75-24.27-14.55-34.63-23.41-14.6,12.55-27.1,27.48-36.94,44.23-16.7,28.1-25.02,60.36-24.98,96.8,0,35.56,8.42,67.52,25.26,95.88,16.92,28.34,40.68,50.62,71.29,66.87,30.68,16.22,66.57,24.35,107.67,24.37,33.76,0,62.66-4.95,86.7-14.85,23.38-9.38,44.21-24.15,60.8-43.11l-72.78-78.44c-11.14,8.83-21.7,15.38-31.83,19.8-10.06,4.42-22.9,6.55-38.53,6.55s-28.19-2.74-38.89-8.23c-10.62-5.41-19.26-14.05-24.69-24.67-1.56-2.97-2.9-6.05-4-9.22h234.19c.36-5.25.78-11.12,1.21-17.44.43-6.4.65-12.19.65-17.52,0-40.82-8.54-75.06-25.62-102.73ZM593.62,918.19c1.03-5.78,2.75-11.4,5.14-16.76,4.1-9.41,10.84-17.43,19.41-23.08,8.49-5.48,18.41-8.22,29.97-8.22s21.41,2.74,29.61,8.22c8.21,5.49,14.7,13.18,19.41,23.08,2.55,5.32,4.37,10.95,5.42,16.76h-108.96ZM932.09,1140.12c-15.99,0-29.4-5.56-40.25-16.68-10.84-11.12-16.26-25.36-16.27-42.73,0-17.67,5.42-31.83,16.27-42.49,10.84-10.66,24.26-15.99,40.25-15.99s29.4,5.33,40.24,15.99,16.27,24.83,16.27,42.49c0,17.37-5.42,31.61-16.27,42.73s-24.26,16.68-40.24,16.68ZM406.53,265.98c-13.34-19.12-32.25-33.71-56.73-43.79-1.02-.45-2.07-.83-3.14-1.14,17.56-9.83,31.33-22.24,41.39-37.4,12.13-18.2,18.2-38.94,18.2-62.22,0-35.11-14.2-63.98-42.6-86.6C335.25,12.2,291.22.88,231.57.86H.8v393.25h230.77c59.65.02,103.68,11.34,132.08,33.96,2.55,2.03,4.98,4.11,7.3,6.25,3.14-1.89,6.15-3.88,9.04-5.96,31.11-22.39,46.64-53.57,46.59-93.53,0-26.81-6.68-49.76-20.05-68.85ZM143.94,109.55h67.93c16.42,0,28.45,2.87,36.11,8.6,7.56,5.72,11.42,14.25,11.42,25.67s-3.86,19.42-11.42,25.36c-7.64,5.94-19.67,8.91-36.11,8.91h-67.93v-68.54ZM267.67,344.05c-7.99,6.17-20.02,9.24-36.1,9.21h-87.63v-72.43h87.63c16.05,0,28.11,3.05,36.1,9.22,8.07,6.17,12.06,15.15,12.06,26.96s-3.99,20.87-12.06,27.04ZM807.05,178.69c-17.05-27.65-39.67-48.49-67.86-62.53-28.19-14.09-58.94-21.12-92.26-21.1-36.25,0-68.86,7.9-97.83,23.69-28.45,15.26-52.15,38.05-68.5,65.88-16.7,28.1-25.02,60.37-24.97,96.8,0,35.57,8.42,67.53,25.26,95.89,16.91,28.33,40.67,50.62,71.28,66.87,30.68,16.22,66.57,24.35,107.67,24.37,33.75,0,62.65-4.95,86.7-14.85,23.37-9.39,44.2-24.15,60.79-43.11l-72.78-78.45c-11.13,8.83-21.69,15.39-31.82,19.8-10.06,4.42-22.91,6.55-38.53,6.55s-28.18-2.74-38.89-8.23c-10.63-5.42-19.27-14.05-24.7-24.67-1.57-2.97-2.9-6.05-4-9.22h234.19c.36-5.25.78-11.12,1.21-17.44.43-6.4.64-12.19.64-17.52,0-40.82-8.54-75.07-25.62-102.74ZM593.62,244.57c1.02-5.77,2.75-11.4,5.14-16.76,4.09-9.41,10.84-17.43,19.41-23.08,8.49-5.48,18.41-8.23,29.97-8.23s21.41,2.74,29.61,8.23,14.7,13.18,19.41,23.08c2.55,5.32,4.37,10.95,5.42,16.76h-108.96ZM932.09,466.51c-15.99,0-29.4-5.56-40.25-16.68-10.84-11.12-16.26-25.36-16.27-42.73,0-17.67,5.42-31.83,16.27-42.49,10.84-10.66,24.26-15.99,40.25-15.99s29.4,5.33,40.24,15.99,16.27,24.83,16.27,42.49c0,17.37-5.42,31.61-16.27,42.73-10.85,11.12-24.26,16.68-40.24,16.68ZM276.34,726.75c-.27.55-.56,1.09-.85,1.62M406.53,659.22c-13.34-19.12-32.25-33.71-56.73-43.79-1.02-.45-2.07-.83-3.14-1.14,17.56-9.83,31.33-22.24,41.39-37.4,12.13-18.2,18.2-38.94,18.2-62.22,0-31.96-11.77-58.75-35.3-80.35-2.32-2.14-4.75-4.22-7.3-6.25-28.4-22.62-72.43-33.94-132.08-33.96H.8v461.07h243.11c59.65,0,105.01-11.19,136.08-33.58,10.54-7.58,19.29-16.18,26.25-25.78,13.59-18.74,20.37-41.33,20.34-67.75,0-26.81-6.68-49.76-20.05-68.85ZM143.94,502.79h67.93c16.42,0,28.47,2.89,36.11,8.6,7.56,5.71,11.42,14.24,11.42,25.67s-3.86,19.42-11.42,25.36c-7.64,5.94-19.67,8.91-36.11,8.91h-67.93v-68.54ZM279.31,716.63c-.1.67-.21,1.34-.33,1.99-.25,1.31-.56,2.57-.94,3.78-.18.61-.39,1.2-.61,1.79-.11.29-.22.58-.34.87-.23.57-.49,1.14-.75,1.69-.27.55-.55,1.09-.85,1.62-1.94,3.44-4.55,6.42-7.82,8.92-7.99,6.17-20.02,9.24-36.1,9.21h-87.63v-72.43h87.63c3.9,0,7.56.18,10.98.54h.02c10.67,1.13,19.05,4.01,25.1,8.68,8.07,6.17,12.06,15.15,12.06,26.96,0,2.23-.14,4.35-.42,6.38ZM807.05,571.94c-17.06-27.65-39.68-48.49-67.86-62.53-28.19-14.09-58.94-21.12-92.26-21.1-36.25,0-68.86,7.9-97.83,23.69-28.45,15.26-52.15,38.05-68.5,65.88-16.7,28.1-25.02,60.37-24.98,96.8,0,35.57,8.42,67.53,25.26,95.89,9.88,16.55,22.1,31.04,36.66,43.45,10.36,8.86,21.9,16.66,34.63,23.41,30.68,16.23,66.57,24.35,107.67,24.38,33.76,0,62.66-4.96,86.7-14.86,14.12-5.66,27.3-13.29,39.19-22.63,7.8-6.11,15.03-12.96,21.61-20.47l-72.78-78.45c-11.14,8.84-21.7,15.39-31.83,19.8-10.06,4.42-22.9,6.55-38.53,6.55s-28.19-2.74-38.89-8.22c-10.63-5.42-19.27-14.05-24.69-24.67-1.57-2.97-2.91-6.05-4-9.22h234.19c.36-5.26.78-11.12,1.21-17.44.43-6.4.65-12.19.65-17.52,0-40.82-8.54-75.07-25.62-102.74ZM593.62,637.82c1.03-5.77,2.75-11.4,5.14-16.75,4.1-9.42,10.84-17.44,19.41-23.08,8.49-5.49,18.41-8.23,29.97-8.23s21.41,2.74,29.61,8.23c1.54,1.03,3.02,2.13,4.44,3.32.94.78,1.86,1.61,2.75,2.47,4.9,4.71,8.98,10.48,12.22,17.29,2.55,5.31,4.37,10.95,5.42,16.75h-108.96ZM932.09,859.76c-15.99,0-29.4-5.56-40.25-16.68-10.84-11.12-16.26-25.36-16.27-42.73,0-17.67,5.42-31.83,16.27-42.49,10.84-10.66,24.26-15.99,40.25-15.99s29.4,5.33,40.24,15.99c10.85,10.66,16.27,24.83,16.27,42.49,0,17.37-5.42,31.61-16.27,42.73s-24.26,16.68-40.24,16.68M932.09,859.76c-15.99,0-29.4-5.56-40.25-16.68-10.84-11.12-16.26-25.36-16.27-42.73,0-17.67,5.42-31.83,16.27-42.49,10.84-10.66,24.26-15.99,40.25-15.99s29.4,5.33,40.24,15.99c10.85,10.66,16.27,24.83,16.27,42.49,0,17.37-5.42,31.61-16.27,42.73s-24.26,16.68-40.24,16.68Z"
                        fill="none"
                        stroke="white"
                        strokeWidth="1.5"
                    />
                </svg>

                {/* VERTICAL PROGRESS LINE */}
                <div className="loader-line-container">
                    <div className="loader-line" style={{ transform: `scaleY(${progress / 100})` }}/>
                    {/* <div className="loader-line" style={{ height: `${progress}%` }}/> */}
                </div>
            </div>
        </>
    );
};

export default IntroLoader;
